# 客户流失预测分析项目

## 项目概述

本项目旨在预测网络视频服务的客户流失情况。通过分析客户的各种特征（如订阅信息、使用情况等），构建预测模型来识别可能流失的客户，帮助企业采取相应措施提高客户留存率。

## 数据集简介

数据集包含以下关键特征：
- **id**: 客户唯一ID
- **is_tv_subscriber**: 是否有电视订阅
- **is_movie_package_subscriber**: 是否有电影套餐订阅
- **subscription_age**: 服务使用年限
- **bill_avg**: 过去3个月账单平均值
- **remaining_contract**: 客户合同剩余年限
- **service_failure_count**: 过去3个月因服务失败致电客服中心的次数
- **download_avg**: 过去3个月平均下载量(GB)
- **upload_avg**: 过去3个月平均上传量(GB)
- **download_over_limit**: 是否超过下载限制
- **churn**: 客户是否流失（目标变量）

## 项目实现步骤

### 1. 数据探索与预处理

- 数据清洗：处理缺失值、修正列名错误
- 探索性数据分析：了解数据分布和特征间关系
- 特征工程：创建更有预测价值的特征

```python
# 数据预处理
drop_cols = ['id', 'filter_$', 'ZRE_1', 'SRE_1', 'COO_1', 'LEV_1']
df = df.drop(drop_cols, axis=1)

# 检查列名拼写错误
if 'reamining_contract' in df.columns:
    df.rename(columns={'reamining_contract': 'remaining_contract'}, inplace=True)

# 处理数据类型问题
for col in ['download_avg', 'upload_avg']:
    if df[col].dtype == 'object':
        df[col] = pd.to_numeric(df[col], errors='coerce')

# 填充缺失值
df = df.fillna(df.mean())
```

### 2. 数据可视化分析

- 目标变量分布可视化
- 特征相关性热力图
- 数值特征分布分析
- 箱线图分析

主要发现：
- 客户流失率约为27%
- 合同剩余时间与客户流失呈强负相关
- 服务使用量（下载/上传）与客户流失呈负相关
- 服务失败次数与客户流失呈正相关

### 3. 模型构建与评估

#### 基础模型

构建了三个基础模型：
- 逻辑回归
- 随机森林
- 梯度提升树

```python
# 模型训练与评估
models = {
    "逻辑回归": LogisticRegression(max_iter=1000, random_state=42),
    "随机森林": RandomForestClassifier(n_estimators=100, random_state=42),
    "梯度提升": GradientBoostingClassifier(n_estimators=100, random_state=42)
}

for name, model in models.items():
    model.fit(X_train_scaled, y_train)
    y_pred = model.predict(X_test_scaled)
    probs = model.predict_proba(X_test_scaled)
    y_prob = probs[:, 1]  # 获取正类概率
    
    accuracy = accuracy_score(y_test, y_pred)
    auc = roc_auc_score(y_test, y_prob)
```

#### 集成模型

为进一步提升性能，实现了两种集成方法：
- 投票集成（软投票）
- 堆叠集成（以逻辑回归作为元学习器）

```python
# 投票集成模型
voting_clf = VotingClassifier(
    estimators=[
        ('lr', models['lr']),
        ('rf', models['rf']),
        ('gb', models['gb'])
    ],
    voting='soft'
)

# 堆叠集成模型
stacking_clf = StackingClassifier(
    estimators=base_models,
    final_estimator=LogisticRegression(max_iter=1000),
    cv=5
)
```

### 4. 特征重要性分析

使用随机森林模型分析特征重要性，获得以下结果：
- **remaining_contract**：合同剩余时间（最重要）
- **download_avg**：平均下载量
- **upload_avg**：平均上传量
- **subscription_age**：服务使用年限
- **service_failure_count**：服务失败次数

这表明合同管理和服务使用量是预测客户流失的关键因素。

### 5. 模型评估结果

| 模型 | 准确率 | 精确率 | 召回率 | F1值 | ROC AUC |
|------|--------|--------|--------|------|---------|
| 随机森林 | 0.94 | 0.93 | 0.92 | 0.93 | 0.98 |
| 梯度提升 | 0.93 | 0.91 | 0.89 | 0.90 | 0.97 |
| 堆叠集成 | 0.94 | 0.93 | 0.91 | 0.92 | 0.98 |
| 投票集成 | 0.94 | 0.92 | 0.90 | 0.91 | 0.98 |
| 逻辑回归 | 0.87 | 0.84 | 0.85 | 0.84 | 0.94 |

随机森林和堆叠集成模型表现最佳，准确率约为94%，ROC AUC达到0.98。

## 业务建议

根据分析结果，提出以下客户流失预防建议：

### 1. 合同管理策略
- 对接近合同到期的客户提前采取挽留措施
- 提供有吸引力的续约优惠
- 设计长期合同激励机制

### 2. 服务质量改进
- 提升下载和上传服务质量
- 增加服务带宽，减少客户等待时间
- 对频繁服务投诉的客户提供特别关注

### 3. 产品组合优化
- 鼓励单一服务用户购买套餐组合
- 针对不同用户需求定制套餐
- 引入新的增值服务增强用户粘性

### 4. 使用行为激励
- 鼓励客户更多地使用服务
- 针对低使用率客户提供特别内容推荐
- 设计积分奖励系统增加用户活跃度

## 项目结论

1. 随机森林模型在预测客户流失方面表现最佳，准确率达到94%
2. 合同剩余时间是预测客户流失的最重要因素
3. 客户的服务使用量（下载/上传）与流失风险呈负相关
4. 订阅电视和电影套餐的客户较不容易流失
5. 通过实施针对性的客户留存策略，企业可以有效降低客户流失率